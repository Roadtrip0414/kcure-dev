<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="Kcn">

	<select id="selectKcnList" parameterType="kcure.portal.bbs.ntc.service.impl.NtcVO" resultType="egovMap">
		SELECT A.NTT_ID, A.BBS_ID, A.NTT_SE_CODE
			, A.NTT_SJ, A.NTT_CN, A.RDCNT
			, A.NTCE_BGNDE, A.NTCE_ENDDE, A.NTCR_ID
			, A.NTCR_NM, A.ATCH_FILE_ID, A.NOTICE_AT, A.USE_AT
			, TO_CHAR(A.FRST_REGIST_PNTTM,'YYYY.mm.dd')AS FRST_REGIST_DT
			, (SELECT STRE_FILE_NM FROM PORTAL.KCURE_COM_COMTNFILEDETAIL WHERE ATCH_FILE_ID = A.ATCH_FILE_ID AND tmbnl_yn = 'Y' LIMIT 1) AS STRE_FILE_NM
			, (SELECT FILE_STRE_COURS FROM PORTAL.KCURE_COM_COMTNFILEDETAIL WHERE ATCH_FILE_ID = A.ATCH_FILE_ID AND tmbnl_yn = 'Y' LIMIT 1) AS FILE_STRE_COURS
		FROM PORTAL.KCURE_COM_COMTNBBS A
		WHERE A.BBS_ID = #{bbsId}
		AND A.USE_AT = 'Y'
		<if test="searchKeyword1 != null and searchKeyword1 !=''">
			AND A.NTT_SE_CODE = #{searchKeyword1}
		</if>
		<if test="searchKeyword != null and searchKeyword !=''">
			<if test="searchCondition == 0">
				AND (UPPER(A.NTT_SJ) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%') OR UPPER(A.NTT_CN) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%'))
	 		</if>
			<if test="searchCondition == 1">
	 			AND UPPER(A.NTT_SJ) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%')
	 		</if>
			<if test="searchCondition == 2">
	 			AND UPPER(A.NTT_CN) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%')
	 		</if>
		</if>
    	ORDER BY A.NTT_ID DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<select id="selectKcnListTotCnt" parameterType="kcure.portal.bbs.ntc.service.impl.NtcVO" resultType="java.lang.Integer">
		SELECT
			COUNT(1) AS totcnt
		FROM PORTAL.KCURE_COM_COMTNBBS A
		WHERE A.BBS_ID = #{bbsId}
		AND A.USE_AT = 'Y'
		<if test="searchKeyword1 != null and searchKeyword1 !=''">
			AND A.NTT_SE_CODE = #{searchKeyword1}
		</if>
		<if test="searchKeyword != null and searchKeyword !=''">
			<if test="searchCondition == 0">
				AND (UPPER(A.NTT_SJ) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%') OR UPPER(A.NTT_CN) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%'))
			</if>
			<if test="searchCondition == 1">
				AND UPPER(A.NTT_SJ) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%')
			</if>
			<if test="searchCondition == 2">
				AND UPPER(A.NTT_CN) LIKE CONCAT('%' , UPPER(#{searchKeyword}), '%')
			</if>
		</if>
	</select>

	<select id="selectKcnDetail" parameterType="kcure.portal.bbs.ntc.service.impl.NtcVO" resultType="egovMap">
		SELECT NTT_ID, BBS_ID
			, NTT_SE_CODE, NTT_NO
			, NTT_SJ, NTT_CN
			, RDCNT, USE_AT
			, NTCR_ID, NTCR_NM
			, ATCH_FILE_ID, NOTICE_AT
			, TO_CHAR(FRST_REGIST_PNTTM,'YYYY-mm-dd') AS FRST_REGIST_PNTTM
		FROM PORTAL.KCURE_COM_COMTNBBS
		WHERE BBS_ID = #{bbsId}
		AND NTT_ID = #{nttId}
	</select>
</mapper>