<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="KcureFileLog">

	<!-- 시스템로그 맵 -->
	<!-- <resultMap id="FileLog" type="kcure.portal.sys.log.flm.service.FileLog"> -->
	
	<resultMap id="FileLogVo" type="kcure.portal.sys.log.flm.service.FileLog" >
		<result property="attfUnldDt" column="ATTF_UNLD_DT"/>
		<result property="attfId" column="ATTF_ID"/>
		<result property="attfNm" column="ATTF_NM"/>
		<result property="attfPth" column="ATTF_PTH_NM"/>
		<result property="userId" column="USER_ID"/>
		<result property="connIpAddr" column="CONN_IP_ADDR"/>
		<result property="frstRegpId" column="FRST_REGP_ID"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="lastModpId" column="LAST_MODP_ID"/>
		<result property="lastModfDt" column="LAST_MODF_DT"/>
		<result property="userNm" column="USER_NM"/>
		<result property="menuNm" column="MENU_NM"/>
	</resultMap>
	<sql id="selectfileLog_where">
		<if test="searchBgnDe != null and searchBgnDe != ''">	
		<![CDATA[	
			AND A.ATTF_UNLD_DT BETWEEN TO_TIMESTAMP(CONCAT(#{searchBgnDe},' 00:00:00'), 'YYYY-mm-dd HH24:MI:SS') 
			AND TO_TIMESTAMP(CONCAT(#{searchEndDe},' 23:59:59'), 'YYYY-mm-dd HH24:MI:SS') 
		]]>
		</if>		
		<if test="searchId != null and searchId != ''">	
			<![CDATA[	
				AND A.USER_ID LIKE CONCAT ('%', #{searchId},'%') 
			]]>
		</if>
		<if test="searchFileNm != null and searchFileNm != ''">	
			<![CDATA[	
				AND A.ATTF_NM LIKE CONCAT ('%', #{searchFileNm},'%') 
			]]>
		</if>
		
	</sql>
	<!-- 시스템 로그 목록 조회 -->
	<select id="selectFileLogInf" parameterType="kcure.portal.sys.log.flm.service.FileLog" resultMap="FileLogVo">
			<![CDATA[
			SELECT TO_CHAR(A.ATTF_UNLD_DT, 'YYYY-MM-DD HH24:MI:SS') AS ATTF_UNLD_DT
				, A.ATTF_ID
				, A.ATTF_NM
				, A.ATTF_PTH_NM
				, A.USER_ID
				, A.CONN_IP_ADDR
				, A.FRST_REGP_ID
				, A.FRST_RGST_DT
				, A.LAST_MODP_ID
				, A.LAST_MODF_DT
				, B.USER_NM
				, A.MENU_NM
			FROM KCURE_COM_ATTF_UNLD_HST A
				LEFT OUTER JOIN KCURE_COM_USER B ON A.USER_ID = B.USER_ID
			WHERE 1=1
			]]>
			<!-- where 조건 -->
			<include refid="selectfileLog_where" />
			<![CDATA[		 
				ORDER BY A.ATTF_UNLD_DT DESC
				LIMIT #{recordCountPerPage} OFFSET #{firstIndex} 
			]]>
		
	</select>

	<!-- 시스템 로그 총건수 -->
	<select id="selectFileLogInfCnt" parameterType="kcure.portal.sys.log.flm.service.FileLog" resultType="int">
		<![CDATA[
		SELECT COUNT(A.ATTF_UNLD_DT) CNT
		FROM KCURE_COM_ATTF_UNLD_HST A
			LEFT OUTER JOIN KCURE_COM_USER B ON A.USER_ID = B.USER_ID
		WHERE 1=1
		]]>
		<!-- where 조건 -->
		<include refid="selectfileLog_where" />
	</select>
</mapper>