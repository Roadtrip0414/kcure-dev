<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CdsDetl">

    <resultMap id="cdsDetlList" type="kcure.portal.sys.ctg.cds.service.impl.CtgCdsDetlVO">
		<result property="prtiId" column="PRTI_ID"/>
		<result property="dtsId" column="DTS_ID"/>
		<result property="cdId" column="CD_ID" />
		<result property="cdVl" column="CD_VL" />
		<result property="cdVlNm" column="CD_VL_NM" />
		<result property="useYn" column="USE_YN" />
		<result property="frstRegpId" column="FRST_REGP_ID" />
		<result property="frstRgstDt" column="FRST_RGST_DT" />
		<result property="lastModpId" column="LAST_MODP_ID" />
		<result property="lastModfDt" column="LAST_MODF_DT" />
    </resultMap>

	<select id="selectCdsDetlList" parameterType="comDefaultVO" resultMap="cdsDetlList">
		SELECT	PRTI_ID
				, DTS_ID
				, CD_ID
				, CD_VL
				, CD_VL_NM
				, USE_YN
				, FRST_REGP_ID
				, TO_CHAR(FRST_RGST_DT, 'YYYY-MM-DD') FRST_RGST_DT
				, LAST_MODP_ID
				, TO_CHAR(LAST_MODF_DT, 'YYYY-MM-DD') LAST_MODF_DT
		FROM	PORTAL.KCURE_COM_CDS_DETL
		WHERE	1 = 1
				AND PRTI_ID = #{prtiId} AND DTS_ID = #{dtsId} AND CD_ID = #{cdId}
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>

	<!-- 총건수 조회 -->
	<select id="selectCdsDetlListTotCnt" parameterType="comDefaultVO" resultType="int">
		SELECT	COUNT(1) AS totCnt
		FROM	PORTAL.KCURE_COM_CDS_DETL
		WHERE	1 = 1
				AND PRTI_ID = #{prtiId} AND DTS_ID = #{dtsId} AND CD_ID = #{cdId}
	</select>

	<insert id="insertCdsDetl" parameterType="kcure.portal.sys.ctg.cds.service.impl.CtgCdsDetlVO">
		INSERT INTO PORTAL.KCURE_COM_CDS_DETL
		(
			PRTI_ID
			, DTS_ID
			, CD_ID
			, CD_VL
			, CD_VL_NM
			, USE_YN
			, FRST_REGP_ID
			, FRST_RGST_DT
			, LAST_MODP_ID
			, LAST_MODF_DT
		)
		VALUES
		(
			#{prtiId}
			, #{dtsId}
			, #{cdId}
			, #{cdVl}
			, #{cdVlNm}
			, #{useYn}
			, #{frstRegpId}
			, NOW()
			, #{lastModpId}
			, NOW()
		)
		ON CONFLICT (PRTI_ID, DTS_ID, CD_ID, CD_VL)
		DO UPDATE
		SET		CD_VL_NM = #{cdVlNm}
				, USE_YN = #{useYn}
				, LAST_MODP_ID = #{lastModpId}
				, LAST_MODF_DT = NOW()
	</insert>

	<update id="updateCdsDetl" parameterType="kcure.portal.sys.ctg.cds.service.impl.CtgCdsDetlVO">
		UPDATE	PORTAL.KCURE_COM_CDS_DETL
		SET		CD_VL_NM = #{cdVlNm}
				, USE_YN = #{useYn}
				, LAST_MODP_ID = #{lastModpId}
				, LAST_MODF_DT = NOW()
		WHERE	PRTI_ID = #{prtiId} AND DTS_ID = #{dtsId} AND CD_ID = #{cdId} AND CD_VL = #{cdVl}
	</update>

	<delete id="deleteCdsDetl" parameterType="kcure.portal.sys.ctg.cds.service.impl.CtgCdsDetlVO">
		DELETE
		FROM	PORTAL.KCURE_COM_CDS_DETL
		WHERE	PRTI_ID = #{prtiId} AND DTS_ID = #{dtsId} AND CD_ID = #{cdId} AND CD_VL = #{cdVl}
	</delete>
</mapper>